Curator's note: Prefer the human-authored MLX guides for clarity. - ../docs\\\\\\\_curated/README.md - ../docs\\\\\\\_curated/PYTORCH\\\\\\\_DISSONANCE.md - ../docs\\\\\\\_curated/NUMPY\\\\\\\_USERS.md - ../docs\\\\\\\_curated/COMMON\\\\\\\_PITFALLS.md \\\[\\\](https://github.com/ml-explore/mlx "Source repository")\\\\- \\\[.rst\\\](https://ml-explore.github.io/mlx/build/html/\\\_sources/python/\\\_autosummary/mlx.core.fast.scaled\\\_dot\\\_product\\\_attention.rst "Download source file") - .pdf # mlx.core.fast.scaled\\\\\\\_dot\\\\\\\_product\\\\\\\_attention ## Contents \\\\- \\\[\\\`\\\`scaled\\\_dot\\\_product\\\_attention()\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/#mlx.core.fast.scaled\\\_dot\\\_product\\\_attention) # mlx.core.fast.scaled\\\\\\\_dot\\\\\\\_product\\\\\\\_attention \\\`scaled\\\\\\\_dot\\\\\\\_product\\\\\\\_attention\\\`(\\\\\\\*\\\`q\\\`\\\`:\\\` \\\[\\\`array\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.array.html#mlx.core.array "mlx.core.array")\\\\\\\*, \\\\\\\*\\\`k\\\`\\\`:\\\` \\\[\\\`array\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.array.html#mlx.core.array "mlx.core.array")\\\\\\\*, \\\\\\\*\\\`v\\\`\\\`:\\\` \\\[\\\`array\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.array.html#mlx.core.array "mlx.core.array")\\\\\\\*, \\\\\\\*\\\`\\\\\\\\\\\\\\\*\\\`\\\\\\\*, \\\\\\\*\\\`scale\\\`\\\`:\\\` \\\[\\\`float\\\`\\\](https://docs.python.org/3/library/functions.html#float "(in Python v3.13)")\\\\\\\*, \\\\\\\*\\\`mask\\\`\\\`:\\\` \\\[\\\`None\\\`\\\](https://docs.python.org/3/library/constants.html#None "(in Python v3.13)") \\\`\\\\\\\\|\\\` \\\[\\\`str\\\`\\\](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)") \\\`\\\\\\\\|\\\` \\\[\\\`array\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.array.html#mlx.core.array "mlx.core.array") \\\`\\\\=\\\` \\\`None\\\`\\\\\\\*, \\\\\\\*\\\`stream\\\`\\\`:\\\` \\\[\\\`None\\\`\\\](https://docs.python.org/3/library/constants.html#None "(in Python v3.13)") \\\`\\\\\\\\|\\\` \\\[\\\`Stream\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/stream\\\_class.html#mlx.core.Stream "mlx.core.Stream") \\\`\\\\\\\\|\\\` \\\[\\\`Device\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.Device.html#mlx.core.Device "mlx.core.Device") \\\`\\\\=\\\` \\\`None\\\`\\\\\\\*) → \\\[\\\`array\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.array.html#mlx.core.array "mlx.core.array") A fast implementation of multi-head attention: \\\`\\\\\\\`O\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`=\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`softmax(Q\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`@\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`K.T,\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`dim=-1)\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`@\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`V\\\\\\\`\\\`. Supports: - \\\[Multi-Head Attention\\\](https://arxiv.org/abs/1706.03762) - \\\[Grouped Query Attention\\\](https://arxiv.org/abs/2305.13245) - \\\[Multi-Query Attention\\\](https://arxiv.org/abs/1911.02150) Note: The softmax operation is performed in \\\`\\\\\\\`float32\\\\\\\`\\\` regardless of the input precision. Note: For Grouped Query Attention and Multi-Query Attention, the \\\`\\\\\\\`k\\\\\\\`\\\` and \\\`\\\\\\\`v\\\\\\\`\\\` inputs should not be pre-tiled to match \\\`\\\\\\\`q\\\\\\\`\\\`. In the following the dimensions are given by: - \\\`\\\\\\\`B\\\\\\\`\\\`: The batch size. - \\\`\\\\\\\`N\\\\\\\_q\\\\\\\`\\\`: The number of query heads. - \\\`\\\\\\\`N\\\\\\\_kv\\\\\\\`\\\`: The number of key and value heads. - \\\`\\\\\\\`T\\\\\\\_q\\\\\\\`\\\`: The number of queries per example. - \\\`\\\\\\\`T\\\\\\\_kv\\\\\\\`\\\`: The number of keys and values per example. - \\\`\\\\\\\`D\\\\\\\`\\\`: The per-head dimension. Parameters: - \\\\\\\*\\\\\\\*q\\\\\\\*\\\\\\\* (\\\[\\\*array\\\*\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.array.html#mlx.core.array "mlx.core.array")) – Queries with shape \\\`\\\\\\\`\\\\\\\[B,\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`N\\\\\\\_q,\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`T\\\\\\\_q,\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`D\\\\\\\]\\\\\\\`\\\`. - \\\\\\\*\\\\\\\*k\\\\\\\*\\\\\\\* (\\\[\\\*array\\\*\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.array.html#mlx.core.array "mlx.core.array")) – Keys with shape \\\`\\\\\\\`\\\\\\\[B,\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`N\\\\\\\_kv,\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`T\\\\\\\_kv,\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`D\\\\\\\]\\\\\\\`\\\`. - \\\\\\\*\\\\\\\*v\\\\\\\*\\\\\\\* (\\\[\\\*array\\\*\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.array.html#mlx.core.array "mlx.core.array")) – Values with shape \\\`\\\\\\\`\\\\\\\[B,\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`N\\\\\\\_kv,\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`T\\\\\\\_kv,\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`D\\\\\\\]\\\\\\\`\\\`. - \\\\\\\*\\\\\\\*scale\\\\\\\*\\\\\\\* (\\\[\\\*float\\\*\\\](https://docs.python.org/3/library/functions.html#float "(in Python v3.13)")) – Scale for queries (typically \\\`\\\\\\\`1.0\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`/\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`sqrt(q.shape(-1)\\\\\\\`\\\`) - \\\\\\\*\\\\\\\*mask\\\\\\\*\\\\\\\* (\\\\\\\*Union\\\\\\\\\\\\\\\[None,\\\\\\\* \\\[\\\*str\\\*\\\](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)")\\\\\\\*,\\\\\\\* \\\[\\\*array\\\*\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.array.html#mlx.core.array "mlx.core.array")\\\\\\\*\\\\\\\\\\\\\\\],\\\\\\\* \\\\\\\*optional\\\\\\\*) – A causal, boolean or additive mask to apply to the query-key scores. The mask can have at most 4 dimensions and must be broadcast-compatible with the shape \\\`\\\\\\\`\\\\\\\[B,\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`N,\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`T\\\\\\\_q,\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`T\\\\\\\_kv\\\\\\\]\\\\\\\`\\\`. If an additive mask is given its type must promote to the promoted type of \\\`\\\\\\\`q\\\\\\\`\\\`, \\\`\\\\\\\`k\\\\\\\`\\\`, and \\\`\\\\\\\`v\\\\\\\`\\\`. Returns: The output array. Return type: \\\[\\\*array\\\*\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.array.html#mlx.core.array "mlx.core.array") \\\[\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.fast.rope.html "previous page") previous mlx.core.fast.rope \\\[\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.fast.metal\\\_kernel.html "next page") next mlx.core.fast.metal\\\\\\\_kernel Contents \\\\- \\\[\\\`\\\`scaled\\\_dot\\\_product\\\_attention()\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/#mlx.core.fast.scaled\\\_dot\\\_product\\\_attention) By MLX Contributors © Copyright 2023, MLX Contributors.
