Curator's note: Prefer the human-authored MLX guides for clarity. - ../docs\\\\\\\_curated/README.md - ../docs\\\\\\\_curated/PYTORCH\\\\\\\_DISSONANCE.md - ../docs\\\\\\\_curated/NUMPY\\\\\\\_USERS.md - ../docs\\\\\\\_curated/COMMON\\\\\\\_PITFALLS.md \\\[\\\](https://github.com/ml-explore/mlx "Source repository")\\\\- \\\[.rst\\\](https://ml-explore.github.io/mlx/build/html/\\\_sources/python/\\\_autosummary/mlx.core.fast.metal\\\_kernel.rst "Download source file") - .pdf # mlx.core.fast.metal\\\\\\\_kernel ## Contents \\\\- \\\[\\\`\\\`metal\\\_kernel()\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/#mlx.core.fast.metal\\\_kernel) # mlx.core.fast.metal\\\\\\\_kernel \\\`metal\\\\\\\_kernel\\\`(\\\\\\\*\\\`name\\\`\\\`:\\\` \\\[\\\`str\\\`\\\](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)")\\\\\\\*, \\\\\\\*\\\`input\\\\\\\_names\\\`\\\`:\\\` \\\[\\\`Sequence\\\`\\\](https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence "(in Python v3.13)")\\\`\\\\\\\\\\\\\\\[\\\`\\\[\\\`str\\\`\\\](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)")\\\`\\\\\\\\\\\\\\\]\\\`\\\\\\\*, \\\\\\\*\\\`output\\\\\\\_names\\\`\\\`:\\\` \\\[\\\`Sequence\\\`\\\](https://docs.python.org/3/library/collections.abc.html#collections.abc.Sequence "(in Python v3.13)")\\\`\\\\\\\\\\\\\\\[\\\`\\\[\\\`str\\\`\\\](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)")\\\`\\\\\\\\\\\\\\\]\\\`\\\\\\\*, \\\\\\\*\\\`source\\\`\\\`:\\\` \\\[\\\`str\\\`\\\](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)")\\\\\\\*, \\\\\\\*\\\`header\\\`\\\`:\\\` \\\[\\\`str\\\`\\\](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)") \\\`\\\\=\\\` \\\`''\\\`\\\\\\\*, \\\\\\\*\\\`ensure\\\\\\\_row\\\\\\\_contiguous\\\`\\\`:\\\` \\\[\\\`bool\\\`\\\](https://docs.python.org/3/library/functions.html#bool "(in Python v3.13)") \\\`\\\\=\\\` \\\`True\\\`\\\\\\\*, \\\\\\\*\\\`atomic\\\\\\\_outputs\\\`\\\`:\\\` \\\[\\\`bool\\\`\\\](https://docs.python.org/3/library/functions.html#bool "(in Python v3.13)") \\\`\\\\=\\\` \\\`False\\\`\\\\\\\*) → \\\[\\\`object\\\`\\\](https://docs.python.org/3/library/functions.html#object "(in Python v3.13)") A jit-compiled custom Metal kernel defined from a source string. Full documentation: \\\[Custom Metal Kernels\\\](https://ml-explore.github.io/mlx/build/html/dev/custom\\\_metal\\\_kernels.html#custom-metal-kernels). Parameters: - \\\\\\\*\\\\\\\*name\\\\\\\*\\\\\\\* (\\\[\\\*str\\\*\\\](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)")) – Name for the kernel. - \\\\\\\*\\\\\\\*input\\\\\\\_names\\\\\\\*\\\\\\\* (\\\\\\\*List\\\\\\\\\\\\\\\[\\\\\\\*\\\[\\\*str\\\*\\\](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)")\\\\\\\*\\\\\\\\\\\\\\\]\\\\\\\*) – The parameter names of the inputs in the function signature. - \\\\\\\*\\\\\\\*output\\\\\\\_names\\\\\\\*\\\\\\\* (\\\\\\\*List\\\\\\\\\\\\\\\[\\\\\\\*\\\[\\\*str\\\*\\\](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)")\\\\\\\*\\\\\\\\\\\\\\\]\\\\\\\*) – The parameter names of the outputs in the function signature. - \\\\\\\*\\\\\\\*source\\\\\\\*\\\\\\\* (\\\[\\\*str\\\*\\\](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)")) – Source code. This is the body of a function in Metal, the function signature will be automatically generated. - \\\\\\\*\\\\\\\*header\\\\\\\*\\\\\\\* (\\\[\\\*str\\\*\\\](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)")) – Header source code to include before the main function. Useful for helper functions or includes that should live outside of the main function body. - \\\\\\\*\\\\\\\*ensure\\\\\\\_row\\\\\\\_contiguous\\\\\\\*\\\\\\\* (\\\[\\\*bool\\\*\\\](https://docs.python.org/3/library/functions.html#bool "(in Python v3.13)")) – Whether to ensure the inputs are row contiguous before the kernel runs. Default: \\\`\\\\\\\`True\\\\\\\`\\\`. - \\\\\\\*\\\\\\\*atomic\\\\\\\_outputs\\\\\\\*\\\\\\\* (\\\[\\\*bool\\\*\\\](https://docs.python.org/3/library/functions.html#bool "(in Python v3.13)")) – Whether to use atomic outputs in the function signature e.g. \\\`\\\\\\\`device\\\\\\\`\\\`\\\\\\\` \\\\\\\`\\\`\\\\\\\`atomic\\\\\\\`\\\`. Default: \\\`\\\\\\\`False\\\\\\\`\\\`. Returns: Callable \\\`\\\\\\\`metal\\\\\\\_kernel\\\\\\\`\\\`. Example \\\`\\\`\\\`python def exp\\\_elementwise(a: mx.array): source = ''' uint elem = thread\\\_position\\\_in\\\_grid.x; T tmp = inp\\\[elem\\\]; out\\\[elem\\\] = metal::exp(tmp); ''' kernel = mx.fast.metal\\\_kernel( name="myexp", input\\\_names=\\\["inp"\\\], output\\\_names=\\\["out"\\\], source=source ) outputs = kernel( inputs=\\\[a\\\], template=\\\[("T", mx.float32)\\\], grid=(a.size, 1, 1), threadgroup=(256, 1, 1), output\\\_shapes=\\\[a.shape\\\], output\\\_dtypes=\\\[a.dtype\\\], verbose=True, ) return outputs\\\[0\\\] a = mx.random.normal(shape=(4, 16)).astype(mx.float16) b = exp\\\_elementwise(a) assert mx.allclose(b, mx.exp(a)) \\\`\\\`\\\` \\\[\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.fast.scaled\\\_dot\\\_product\\\_attention.html "previous page") previous mlx.core.fast.scaled\\\\\\\_dot\\\\\\\_product\\\\\\\_attention \\\[\\\](https://ml-explore.github.io/mlx/build/html/python/fft.html "next page") next FFT Contents \\\\- \\\[\\\`\\\`metal\\\_kernel()\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/#mlx.core.fast.metal\\\_kernel) By MLX Contributors © Copyright 2023, MLX Contributors.
