Curator's note: Prefer the human-authored MLX guides for clarity. - ../docs\\\\\\\_curated/README.md - ../docs\\\\\\\_curated/PYTORCH\\\\\\\_DISSONANCE.md - ../docs\\\\\\\_curated/NUMPY\\\\\\\_USERS.md - ../docs\\\\\\\_curated/COMMON\\\\\\\_PITFALLS.md \\\[\\\](https://github.com/ml-explore/mlx "Source repository")\\\\- \\\[.rst\\\](https://ml-explore.github.io/mlx/build/html/\\\_sources/python/nn/module.rst "Download source file") - .pdf # Module ## Contents \\\\- \\\[\\\`\\\`Module\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/#mlx.nn.Module) # Module \\\\\\\*\\\`class\\\` \\\\\\\*\\\`Module\\\` Base class for building neural networks with MLX. All the layers provided in \\\`\\\\\\\`mlx.nn.layers\\\\\\\`\\\` subclass this class and your models should do the same. A \\\`\\\\\\\`Module\\\\\\\`\\\` can contain other \\\`\\\\\\\`Module\\\\\\\`\\\` instances or \\\[\\\`\\\`mlx.core.array\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.array.html#mlx.core.array "mlx.core.array") instances in arbitrary nesting of python lists or dicts. The \\\`\\\\\\\`Module\\\\\\\`\\\` then allows recursively extracting all the \\\[\\\`\\\`mlx.core.array\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.array.html#mlx.core.array "mlx.core.array") instances using \\\[\\\`\\\`mlx.nn.Module.parameters()\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.parameters.html#mlx.nn.Module.parameters "mlx.nn.Module.parameters"). In addition, the \\\`\\\\\\\`Module\\\\\\\`\\\` has the concept of trainable and non trainable parameters (called “frozen”). When using \\\[\\\`\\\`mlx.nn.value\\\_and\\\_grad()\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.nn.value\\\_and\\\_grad.html#mlx.nn.value\\\_and\\\_grad "mlx.nn.value\\\_and\\\_grad") the gradients are returned only with respect to the trainable parameters. All arrays in a module are trainable unless they are added in the “frozen” set by calling \\\[\\\`\\\`freeze()\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.freeze.html#mlx.nn.Module.freeze "mlx.nn.Module.freeze"). \\\`\\\`\\\`python import mlx.core as mx import mlx.nn as nn class MyMLP(nn.Module): def \\\_\\\_init\\\_\\\_(self, in\\\_dims: int, out\\\_dims: int, hidden\\\_dims: int = 16): super().\\\_\\\_init\\\_\\\_() self.in\\\_proj = nn.Linear(in\\\_dims, hidden\\\_dims) self.out\\\_proj = nn.Linear(hidden\\\_dims, out\\\_dims) def \\\_\\\_call\\\_\\\_(self, x): x = self.in\\\_proj(x) x = mx.maximum(x, 0) return self.out\\\_proj(x) model = MyMLP(2, 1) # All the model parameters are created but since MLX is lazy by # default, they are not evaluated yet. Calling \\\`mx.eval\\\` actually # allocates memory and initializes the parameters. mx.eval(model.parameters()) # Setting a parameter to a new value is as simply as accessing that # parameter and assigning a new array to it. model.in\\\_proj.weight = model.in\\\_proj.weight \\\* 2 mx.eval(model.parameters()) \\\`\\\`\\\` Attributes | | | |----|----| | \\\[\\\`\\\`Module.training\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.training.html#mlx.nn.Module.training "mlx.nn.Module.training") | Boolean indicating if the model is in training mode. | | \\\[\\\`\\\`Module.state\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.state.html#mlx.nn.Module.state "mlx.nn.Module.state") | The module's state dictionary | Methods | | | |----|----| | \\\[\\\`\\\`Module.apply\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.apply.html#mlx.nn.Module.apply "mlx.nn.Module.apply")(map\\\\\\\_fn\\\\\\\\\\\\\\\[, filter\\\\\\\_fn\\\\\\\\\\\\\\\]) | Map all the parameters using the provided \\\`\\\\\\\`map\\\\\\\_fn\\\\\\\`\\\` and immediately update the module with the mapped parameters. | | \\\[\\\`\\\`Module.apply\\\_to\\\_modules\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.apply\\\_to\\\_modules.html#mlx.nn.Module.apply\\\_to\\\_modules "mlx.nn.Module.apply\\\_to\\\_modules")(apply\\\\\\\_fn) | Apply a function to all the modules in this instance (including this instance). | | \\\[\\\`\\\`Module.children\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.children.html#mlx.nn.Module.children "mlx.nn.Module.children")() | Return the direct descendants of this Module instance. | | \\\[\\\`\\\`Module.eval\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.eval.html#mlx.nn.Module.eval "mlx.nn.Module.eval")() | Set the model to evaluation mode. | | \\\[\\\`\\\`Module.filter\\\_and\\\_map\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.filter\\\_and\\\_map.html#mlx.nn.Module.filter\\\_and\\\_map "mlx.nn.Module.filter\\\_and\\\_map")(filter\\\\\\\_fn\\\\\\\\\\\\\\\[, map\\\\\\\_fn, ...\\\\\\\\\\\\\\\]) | Recursively filter the contents of the module using \\\`\\\\\\\`filter\\\\\\\_fn\\\\\\\`\\\`, namely only select keys and values where \\\`\\\\\\\`filter\\\\\\\_fn\\\\\\\`\\\` returns true. | | \\\[\\\`\\\`Module.freeze\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.freeze.html#mlx.nn.Module.freeze "mlx.nn.Module.freeze")(\\\\\\\\\\\\\\\*\\\\\\\\\\\\\\\[, recurse, keys, strict\\\\\\\\\\\\\\\]) | Freeze the Module's parameters or some of them. | | \\\[\\\`\\\`Module.leaf\\\_modules\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.leaf\\\_modules.html#mlx.nn.Module.leaf\\\_modules "mlx.nn.Module.leaf\\\_modules")() | Return the submodules that do not contain other modules. | | \\\[\\\`\\\`Module.load\\\_weights\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.load\\\_weights.html#mlx.nn.Module.load\\\_weights "mlx.nn.Module.load\\\_weights")(file\\\\\\\_or\\\\\\\_weights\\\\\\\\\\\\\\\[, strict\\\\\\\\\\\\\\\]) | Update the model's weights from a \\\`\\\\\\\`.npz\\\\\\\`\\\`, a \\\`\\\\\\\`.safetensors\\\\\\\`\\\` file, or a list. | | \\\[\\\`\\\`Module.modules\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.modules.html#mlx.nn.Module.modules "mlx.nn.Module.modules")() | Return a list with all the modules in this instance. | | \\\[\\\`\\\`Module.named\\\_modules\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.named\\\_modules.html#mlx.nn.Module.named\\\_modules "mlx.nn.Module.named\\\_modules")() | Return a list with all the modules in this instance and their name with dot notation. | | \\\[\\\`\\\`Module.parameters\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.parameters.html#mlx.nn.Module.parameters "mlx.nn.Module.parameters")() | Recursively return all the \\\[\\\`\\\`mlx.core.array\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.array.html#mlx.core.array "mlx.core.array") members of this Module as a dict of dicts and lists. | | \\\[\\\`\\\`Module.save\\\_weights\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.save\\\_weights.html#mlx.nn.Module.save\\\_weights "mlx.nn.Module.save\\\_weights")(file) | Save the model's weights to a file. | | \\\[\\\`\\\`Module.set\\\_dtype\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.set\\\_dtype.html#mlx.nn.Module.set\\\_dtype "mlx.nn.Module.set\\\_dtype")(dtype\\\\\\\\\\\\\\\[, predicate\\\\\\\\\\\\\\\]) | Set the dtype of the module's parameters. | | \\\[\\\`\\\`Module.train\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.train.html#mlx.nn.Module.train "mlx.nn.Module.train")(\\\\\\\\\\\\\\\[mode\\\\\\\\\\\\\\\]) | Set the model in or out of training mode. | | \\\[\\\`\\\`Module.trainable\\\_parameters\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.trainable\\\_parameters.html#mlx.nn.Module.trainable\\\_parameters "mlx.nn.Module.trainable\\\_parameters")() | Recursively return all the non frozen \\\[\\\`\\\`mlx.core.array\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.array.html#mlx.core.array "mlx.core.array") members of this Module as a dict of dicts and lists. | | \\\[\\\`\\\`Module.unfreeze\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.unfreeze.html#mlx.nn.Module.unfreeze "mlx.nn.Module.unfreeze")(\\\\\\\\\\\\\\\*\\\\\\\\\\\\\\\[, recurse, keys, strict\\\\\\\\\\\\\\\]) | Unfreeze the Module's parameters or some of them. | | \\\[\\\`\\\`Module.update\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.update.html#mlx.nn.Module.update "mlx.nn.Module.update")(parameters) | Replace the parameters of this Module with the provided ones in the dict of dicts and lists. | | \\\[\\\`\\\`Module.update\\\_modules\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.update\\\_modules.html#mlx.nn.Module.update\\\_modules "mlx.nn.Module.update\\\_modules")(modules) | Replace the child modules of this \\\[\\\`\\\`Module\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/#mlx.nn.Module "mlx.nn.Module") instance with the provided ones in the dict of dicts and lists. | \\\[\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.nn.average\\\_gradients.html "previous page") previous mlx.nn.average\\\\\\\_gradients \\\[\\\](https://ml-explore.github.io/mlx/build/html/python/nn/\\\_autosummary/mlx.nn.Module.training.html "next page") next mlx.nn.Module.training Contents \\\\- \\\[\\\`\\\`Module\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/#mlx.nn.Module) By MLX Contributors © Copyright 2023, MLX Contributors.
