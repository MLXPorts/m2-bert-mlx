Curator's note: Prefer the human-authored MLX guides for clarity. - ../docs\\\\\\\_curated/README.md - ../docs\\\\\\\_curated/PYTORCH\\\\\\\_DISSONANCE.md - ../docs\\\\\\\_curated/NUMPY\\\\\\\_USERS.md - ../docs\\\\\\\_curated/COMMON\\\\\\\_PITFALLS.md \\\\## Curated Notes - Ensure \\\\\\\`trace\\\\\\\_file\\\\\\\` does not exist before capture; some systems won’t overwrite and will silently fail to start capture. - Scope captures tightly to the region you’re profiling to keep traces small and readable. - Label custom kernels and streams where possible to improve Xcode timeline clarity. \\\[\\\](https://github.com/ml-explore/mlx "Source repository")\\\\- \\\[.rst\\\](https://ml-explore.github.io/mlx/build/html/\\\_sources/dev/metal\\\_debugger.rst "Download source file") - .pdf # Metal Debugger ## Contents \\\\- \\\[Xcode Workflow\\\](https://ml-explore.github.io/mlx/build/html/#xcode-workflow) # Metal Debugger Profiling is a key step for performance optimization. You can build MLX with the \\\`\\\\\\\`MLX\\\\\\\_METAL\\\\\\\_DEBUG\\\\\\\`\\\` option to improve the Metal debugging and optimization workflow. The \\\`\\\\\\\`MLX\\\\\\\_METAL\\\\\\\_DEBUG\\\\\\\`\\\` debug option: - Records source during Metal compilation, for later inspection while debugging. - Labels Metal objects such as command queues, improving capture readability. To build with debugging enabled in Python prepend \\\`\\\\\\\`CMAKE\\\\\\\_ARGS="-DMLX\\\\\\\_METAL\\\\\\\_DEBUG=ON"\\\\\\\`\\\` to the build call. The \\\[\\\`\\\`metal.start\\\_capture()\\\`\\\`\\\](https://ml-explore.github.io/mlx/build/html/python/\\\_autosummary/mlx.core.metal.start\\\_capture.html#mlx.core.metal.start\\\_capture "mlx.core.metal.start\\\_capture") function initiates a capture of all MLX GPU work. Note To capture a GPU trace you must run the application with \\\`\\\\\\\`MTL\\\\\\\_CAPTURE\\\\\\\_ENABLED=1\\\\\\\`\\\`. \\\`\\\`\\\`python import mlx.core as mx a = mx.random.uniform(shape=(512, 512)) b = mx.random.uniform(shape=(512, 512)) mx.eval(a, b) trace\\\_file = "mlx\\\_trace.gputrace" # Make sure to run with MTL\\\_CAPTURE\\\_ENABLED=1 and # that the path trace\\\_file does not already exist. mx.metal.start\\\_capture(trace\\\_file) for \\\_ in range(10): mx.eval(mx.add(a, b)) mx.metal.stop\\\_capture() \\\`\\\`\\\` You can open and replay the GPU trace in Xcode. The \\\`\\\\\\\`Dependencies\\\\\\\`\\\` view has a great overview of all operations. Checkout the \\\[Metal debugger documentation\\\](https://developer.apple.com/documentation/xcode/metal-debugger) for more information. !\\\[../\\\_images/capture.png\\\](https://ml-explore.github.io/mlx/build/html/\\\_images/capture.png) ## Xcode Workflow You can skip saving to a path by running within Xcode. First, generate an Xcode project using CMake. \\\`\\\`\\\`python mkdir build && cd build cmake .. -DMLX\\\_METAL\\\_DEBUG=ON -G Xcode open mlx.xcodeproj \\\`\\\`\\\` Select the \\\`\\\\\\\`metal\\\\\\\_capture\\\\\\\`\\\` example schema and run. !\\\[../\\\_images/schema.png\\\](https://ml-explore.github.io/mlx/build/html/\\\_images/schema.png) \\\[\\\](https://ml-explore.github.io/mlx/build/html/dev/extensions.html "previous page") previous Custom Extensions in MLX \\\[\\\](https://ml-explore.github.io/mlx/build/html/dev/custom\\\_metal\\\_kernels.html "next page") next Custom Metal Kernels Contents \\\\- \\\[Xcode Workflow\\\](https://ml-explore.github.io/mlx/build/html/#xcode-workflow) By MLX Contributors © Copyright 2023, MLX Contributors.
